你觉得Erlang缺哪些库

Erlang本身的一些机制的不足

1. 运行时record 的问题，

Record 在erlang中并不是一个运行时可见的数据结构。代码中所有对record的变量的赋值，读取等操作全部会转化为对tuple的element的操作。这种形式带来了无穷无尽的麻烦：主要是在产品升级的时候。我们的电信产品一般会要求6个9，即：99.9999%的稳定性，和0 downtime。即：升级的过程中不允许有电话打不通的时间。如果某个record在版本升级中结构变化了，而不允许有downtime意味着大量的进程要有能力处理旧的和新的record，一不小心就crash给你看。

这个问题我跟OTP team讨论过无数次了，他们也没有很强的想法在这上面，beam文件本身已经包含了record的相关信息不知道为什么不肯做一个简单的实现。

现在我们的实现方法是在运行时反编译自己，获取record的信息进行操作。但这个要求编译的时候要带debug作息，而且cookie一旦泄漏，源代码很容易被反编译出来。

在OTP R17中引入了一个新的数据类型，叫做MAP，类似于JSON的数据结构，它与record相比做了质的变化：运行时可见了，并且可随意添加成员变量。这无疑是对record这种旧的数据结构的另外一种演化方向。我很喜欢这种变化。但是我们同时也不得不考虑软件维护的成本：不可能仅仅是为了使用这种数据结构而把原来的上百W行代码重写。所以个人而言，我还是希望能有一个运行行的record，例如把record转化为map，并且兼容对record的操作方式，并在几个release内慢慢淘汰record这种数据结构。

1. 字符串的处理，

字符串在erlang中一直是个弱点。

包括正则表达式。在很多语言中正则表达式本身是做为一种特殊的数据类型存在的，比如用//包住，在erlang中，RE本身是做为字符串处理的，而字符串和RE都有转义的问题，要匹配一些特殊字符就要进行多次转义，非常恶心，比如用"\\\"去匹配 "\"。如果要匹配多个这样的字符，那写出来的正则表达式简直无法入眼。

另外，字符串的处理效率也是个问题。字符串在erlang本来是以Lists存在的，虽然有个string的库，不管说它丰富不丰富，效率就是个问题。



1. 运行效率的问题，虽然R17已经有了LLVM backend，但是效率还是不够。而且HIPE本身存在的问题也很多，有很多莫名其妙的bug。而HIPE本身年纪太大， 很多想法已经太out。

谢@bhuztez 提醒，LLVM的效率的确不如HIPE，在LLVM的performance test中可以看其效率与原来的HIPE基本持平。但是好处是LLVM是开源的工具链，其做为backend稳定性应该会比HIPE强。在乌不撒拉大学的原来的HIPE主页上，感觉终于把HIPE赶走了可以松一口气了。R17的release notes中也认为LLVM HIPE可以做production usage.



1. mnesia问题。mnesia效率实在太差，差的都不想吐嘈了，现在完全成为了系统的瓶颈。

Mnesia本身一般不会存储用户数据，一般只是一些配置数据。在我们的产品中大约有几百张表，每个表一般只有几条到几十条不超过上百条记录。即便这样，mnesia已然不堪重负，严重的成为了系统的瓶颈。

1. 同时Mnesia为SNMP做了很多优化，但是这些优化很多时候限定了mnesia data schema本身，这种绑定有时候不但不会带来收益，会带来很多问题。
2. 分级的Log。现在error_logger打印的东西太夸张，而且只有error，warning，info三级，不够用。customer一看到有error_logger就报bug。

谢@王宇成 提醒，已经有现在的库可以用[http://github.com/basho/lager](https://link.zhihu.com/?target=http%3A//github.com/basho/lager)

1. 调试工具实在太烂，有时候很容易把自己卡死。我后来不得不改了他们的源代码，没事别乱打印，wx太慢，一打印大数据结构就卡死了。

如果有一个更好的调试的库就更好了。

1. dbg:tracer只能trace MFA 或者msg, 远远不到完善的地步。

需要一个更好的dbg的库。

1. to_erl环境变量的问题，跟OTP的人们说过，他们坚决不改。

但是其实这个很简单，可以考虑做个工具，在用户用to_erl连接到VM的时候把用户的一个ENV（如display） apply一下，只要不影响运行中的程序就可以了。

1. 两个site连接起来之后不能立即通信，要sleep一会儿。

我搜索了好久，仍然搞不清楚erlang是如何解析和连接node()的。

1. 文档不健全，很多文档语焉不详，要必须跟OTP的人聊过或看过代码之后才明白。 从如描述smp的那一大段。
2. 没有bench mark的工具
3. OTP升级不够平滑。每次换OTP都心惊胆颤。