# 换行 (Line Feed)

[![YYQ](https://pic3.zhimg.com/v2-c4432de041354a82800b86e53483c9c7_xs.jpg?source=172ae18b)](https://www.zhihu.com/people/anthony.yuan)

[YYQ](https://www.zhihu.com/people/anthony.yuan)

一个安静的家伙 对大多数事情都没有兴趣

关注他

5 人赞同了该文章

## **换行方式**

在早期的打印机时代，开始新的一行要占用两个字符的时间。如果到了一行的结尾处，你要快速回到新的一行的开头，需要打印针头在纸面上飞快地掠过，常常会在纸面上留下污点。解决这个问题的办法就是，用两个字符：一个字符<Return>来移到第一列，另一个字符<Line feed>来新增一行。

计算机产生以后，存储较为昂贵，在如何解决回车换行这个老问题上，人们产生了不同的意见。UNIX人认为在到达一行的结尾时新增一行<Line feed> (LF)，而Mac人则认同<Return> (CR)的解决办法，MS则坚持古老的<Return><Line feed> (CRLF)的方法。这就意味着，如果你将一个文件从一个系统转移到另一个系统，就面临着回车换行的问题。而Vim编辑器则会自动识别出出这种文件格式方面的区别，并做出相应处理。

fileformats选项，用于处理文件格式。以下命令告诉vim将UNIX文件格式做为第一选择，而将MS-DOS的文件格式做为第二选择：

```vim
:set fileformats=unix,dos
```

检测到的文件格式会被存放在fileformat选项中，我们可以用以下命令来查询：

```vim
:set fileformat?
```

我们还可以利用fileformat选项，来转换各种文件格式。例如，使用以下命令将名为readme.txt的MS-DOS格式的文件，转换为UNIX格式的文件。

```vim
:set fileformat=unix
```

在默认情况下，Vim认为文件是由行组成的，并且文件最后一行是以<EOL>为结束符的。如果你想设置文件以<EOL>结束符结尾，则可以用以下命令：

```vim
:set endofline
```

如果你想设置文件不以<EOL>结束符来结尾，则可以使用以下命令：

```vim
:set noendofline
```

## **显示换行**

使用以下命令进入<list mode>，那么就可以清楚的看到以“$”表示的换行符和以“^I”表示的制表符。

```vim
:set list
```

![img](https://pic1.zhimg.com/80/v2-d0414bf48ea6d2c47dd17bc46cd07c98_720w.png)

你可以使用以下命令退出<list mode>：

```vim
:set nolist
```

## **删除换行**

![img](https://pic3.zhimg.com/80/v2-c6d187ea194b7c8761e6f4d28563793a_720w.png)

可以用以下命令删除换行符：

```vim
:%s/\n//g
```

可以用以下命令删除DOS文件中的回车符：

```vim
:%s/\r//g
```

可以用以下命令删除DOS文件中的“^M”：

```vim
:%s/^M//g
```

可以用以下命令删除行尾的空格以及DOS回车符。它没有使用“/”字符作为替换命令各个参数间的分隔符，而是使用了“#”字符。命令还使用了“\?”正则表达式，用来匹配它前面出现的字符0次或1次。

```vim
:%s#\s*\r\?$##
```

可以用以下命令删除三行空行：

```vim
:%s/^\n\{3}//
```

可以用以下命令将连续的两个空行替换成一个空行：

```vim
:%s/\n\n/\r/g
```

## **自动换行**

在默认情况下，Vim是不会自动换行的，也就是说我们需要自己决定回车的位置。但是我们也可以通过指定textwidth选项，让Vim自动在指定位置换行。例如，使用以下命令指定在30列时自动换行。由于在遇到空格时才会自动换行，所以换行的精确位置可能会小于你指定的列宽。

```vim
:set textwidth=29
```

而以下命令告诉Vim从右面算起当达到10个字符的空格时要换行：

```vim
:set wrapmargin=10
```

注意：选项textwidth优先于wrapmargin。如果要使wrapmargin选项生效，必须将textwidth设置为0（这也是默认值）。

在指定了文本宽度的情况下，当我们将一行中的前几个文字删掉时，Vim并不会将后面行中的文本移动上来，而是形成了一些长短不一的段落。可以使用以下几种方法来处理这个问题：

一种方法是，在可视化模式下选中这些文本，然后用**gq**命令来格式化选中的段落。

![img](https://pic2.zhimg.com/80/v2-43e4a4946a860751bc317d892bf65275_720w.png)

另一种方法是，使用**gqmotion**命令来完成格式。例如**:gq4j**命令，告诉Vim要格式化本行，以及之后的4行，这样就达到了格式化5行的目的。如果要格式化整个段落，可以将光标放在段落的第一行上，然后执行命令**gq}**。而使用命令**gqip**可以格式化当前段落，而且并不必要将光标放在段落的第一行上。如果要想格式化一行，可以使用命令**gqgq**，也可以简记为**gqq**。

## **合并行**

命令**J**可以将本行和下一行合并为一行，同时用空格分隔这两行。我们也可以使用数字前缀来合并多行。例如**3J**会将当前行及之后的三行合并为一行。

通过设置joinspace选项，可以控制合并两行时的分隔符（如果一行是以标点符号来结尾）。如果设置**:set nojoinspaces**，用J命令合并两行时会用一个空格来分隔；如果设置**:set joinspaces**，用J命令合并两行时会用两个空格来分隔。如果不希望用空格来分隔合并的行，可以使用**gJ**命令。

不带参数的**:join**命令，可以将当前行及下一行合并为一行并使用空格来分隔各行。加入范围参数的**:[range]join**命令，可以合并多行。例如**:1,3join**命令，将合并第一到第三行。如果不希望加入空格分隔多行，那么可以使用**:join!**命令。

![img](https://pic1.zhimg.com/80/v2-ac6ff1cb48624ed200975c7eeacb5ed4_720w.png)

编辑于 2017-04-01